@startuml
!theme plain
left to right direction

' Catálogos y dominios básicos
entity "JRGY_CAT_ESTADO_USUARIO" as CAT_EST_USU {
  *COD_ESTADO_USUARIO : NUMBER <<PK>>
  --
  ESTADO_USUARIO : VARCHAR2(30)
}

entity "JRGY_CAT_ESTADO_LABORAL" as CAT_EST_LAB {
  *COD_ESTADO_LABORAL : NUMBER <<PK>>
  --
  ESTADO_LABORAL : VARCHAR2(30)
}

entity "JRGY_CAT_ESTADO_HABITACION" as CAT_EST_HAB {
  *COD_ESTADO_HABITACION : NUMBER <<PK>>
  --
  ESTADO_HABITACION : VARCHAR2(30)
}

entity "JRGY_CAT_TIPO_HABITACION" as CAT_TIPO_HAB {
  *COD_TIPO_HABITACION : NUMBER <<PK>>
  --
  TIPO_HABITACION : VARCHAR2(50)
}

entity "JRGY_CAT_MODO_PAGO" as CAT_MODO_PAGO {
  *COD_MODO_PAGO : NUMBER <<PK>>
  --
  MODO_PAGO : VARCHAR2(30)
}

entity "JRGY_CAT_ESTADO_RESERVA" as CAT_EST_RES {
  *COD_ESTADO_RESERVA : NUMBER <<PK>>
  --
  ESTADO_RESERVA : VARCHAR2(30)
}

entity "JRGY_CAT_TIPO_CONTACTO" as CAT_TIPO_CONTACTO {
  *COD_TIPO : NUMBER <<PK>>
  --
  NOMBRE : VARCHAR2(80)
  DESCRIPCION : VARCHAR2(250)
}

entity "JRGY_CAT_ESTADO_CONTACTO" as CAT_EST_CONTACTO {
  *COD_ESTADO : NUMBER <<PK>>
  --
  NOMBRE : VARCHAR2(50)
}

entity "JRGY_CAT_TIPO_SERVICIO" as CAT_TIPO_SERV {
  *COD_TIPO_SERVICIO : NUMBER <<PK>>
  --
  NOMBRE : VARCHAR2(50)
  DESCRIPCION : VARCHAR2(200)
}

' Geografía
entity "JRGY_REGION" as REGION {
  *COD_REGION : NUMBER <<PK>>
  --
  REGION : VARCHAR2(50)
}

entity "JRGY_CIUDAD" as CIUDAD {
  *COD_CIUDAD : NUMBER <<PK>>
  --
  CIUDAD : VARCHAR2(50)
  COD_REGION : NUMBER <<FK>>
}

entity "JRGY_COMUNA" as COMUNA {
  *COD_COMUNA : NUMBER <<PK>>
  --
  COMUNA : VARCHAR2(50)
  COD_CIUDAD : NUMBER <<FK>>
}

entity "JRGY_CALLE" as CALLE {
  *COD_CALLE : NUMBER <<PK>>
  --
  CALLE : VARCHAR2(50)
  NRO : NUMBER
  COD_COMUNA : NUMBER <<FK>>
}

' Seguridad y roles
entity "JRGY_ROL" as ROL {
  *COD_ROL : NUMBER <<PK>>
  --
  NOMBRE_ROL : VARCHAR2(50)
}

entity "JRGY_USUARIO" as USUARIO {
  *COD_USUARIO : NUMBER <<PK>>
  --
  NOMBRE_USUARIO : VARCHAR2(50)
  APELLIDO1_USUARIO : VARCHAR2(50)
  APELLIDO2_USUARIO : VARCHAR2(50)
  EMAIL_USUARIO : VARCHAR2(100)
  TELEFONO_USUARIO : NUMBER
  CONTRASENA_HASH : VARCHAR2(255)
  COD_ESTADO_USUARIO : NUMBER <<FK>>
}

entity "JRGY_USUARIO_ROL" as USUARIO_ROL {
  *COD_USUARIO : NUMBER <<PK>><<FK>>
  *COD_ROL : NUMBER <<PK>><<FK>>
}

entity "TOKENS" as TOKENS {
  *TOKEN : VARCHAR2(128) <<PK>>
  --
  USER_ID : NUMBER <<FK>>
  EXPIRES_AT : DATE
  CREATED_AT : DATE
}

' Organización y personal
entity "JRGY_DEPARTAMENTO" as DEPTO {
  *COD_DEPARTAMENTO : NUMBER <<PK>>
  --
  NOMBRE : VARCHAR2(100)
  JEFE_EMPLEADO_ID : NUMBER <<FK>>
  PRESUPUESTO : NUMBER
  FECHA_CREACION : DATE
}

entity "JRGY_DEPARTAMENTO_EMPLEADO" as DEPTO_EMP {
  *COD_DEPARTAMENTO : NUMBER <<PK>><<FK>>
  *COD_EMPLEADO : NUMBER <<PK>><<FK>>
}

entity "JRGY_EMPLEADO" as EMPLEADO {
  *COD_EMPLEADO : NUMBER <<PK>>
  --
  COD_USUARIO : NUMBER <<FK>>
  COD_DEPARTAMENTO : NUMBER <<FK>>
  CARGO : VARCHAR2(50)
  FECHA_CONTRATACION : DATE
  SALARIO : NUMBER
  COMISION : NUMBER
  SUELDO_BASE : NUMBER
  COD_ESTADO_LABORAL : NUMBER <<FK>>
}

entity "JRGY_CLIENTE" as CLIENTE {
  *COD_CLIENTE : NUMBER <<PK>>
  --
  COD_USUARIO : NUMBER <<FK>>
  FECHA_ALTA : DATE
}

' Inventario, productos y servicios
entity "JRGY_PROVEEDOR" as PROVEEDOR {
  *COD_PROVEEDOR : NUMBER <<PK>>
  --
  NOMBRE_PROVEEDOR : VARCHAR2(50)
  DIRECCION_PROVEEDOR : VARCHAR2(100)
  TELEFONO_PROVEEDOR : NUMBER
  COD_REGION : NUMBER <<FK>>
}

entity "JRGY_PRODUCTO" as PRODUCTO {
  *COD_PRODUCTO : NUMBER <<PK>>
  --
  NOMBRE_PRODUCTO : VARCHAR2(50)
  COD_TIPO_SERVICIO : NUMBER <<FK>>
  PRECIO_PRODUCTO : NUMBER
  CANTIDAD_PRODUCTO : NUMBER
  STOCK_PRODUCTO : NUMBER
  UMBRAL_ALERTA : NUMBER
}

entity "JRGY_SERVICIO" as SERVICIO {
  *COD_SERVICIO : NUMBER <<PK>>
  --
  NOMBRE : VARCHAR2(100)
  DESCRIPCION : VARCHAR2(500)
  PRECIO : NUMBER
  COD_TIPO_SERVICIO : NUMBER <<FK>>
  ESTADO : VARCHAR2(20)
  ES_DESTACADO : CHAR(1)
  ORDEN : NUMBER
  CREATED_AT : DATE
  UPDATED_AT : DATE
}

entity "JRGY_SERVICIO_HORARIO" as SERVICIO_HORARIO {
  *COD_HORARIO : NUMBER <<PK>>
  --
  COD_SERVICIO : NUMBER <<FK>>
  HORA_INICIO : NUMBER(4,2)
  HORA_FIN : NUMBER(4,2)
}

entity "JRGY_SERVICIO_PRODUCTO" as SERVICIO_PRODUCTO {
  *COD_SERVICIO : NUMBER <<PK>><<FK>>
  *COD_PRODUCTO : NUMBER <<PK>><<FK>>
  --
  CANTIDAD_BASE : NUMBER
  PRECIO_EXTRA : NUMBER
}

entity "JRGY_PEDIDO" as PEDIDO {
  *COD_PEDIDO : NUMBER <<PK>>
  --
  VALOR_TOTAL : NUMBER
  FECHA_PEDIDO : DATE
  COD_EMPLEADO : NUMBER <<FK>>
}

entity "JRGY_DETALLE_PEDIDO" as DET_PEDIDO {
  *COD_PEDIDO : NUMBER <<PK>><<FK>>
  *COD_PROVEEDOR : NUMBER <<PK>><<FK>>
  *COD_PRODUCTO : NUMBER <<PK>><<FK>>
  --
  NOMBRE_PRODUCTO : VARCHAR2(50)
  CANTIDAD_PRODUCTO : NUMBER
  PRECIO_COMPRA : NUMBER
  PRECIO_TOTAL : NUMBER
}

entity "JRGY_MOVIMIENTO_STOCK" as MOV_STOCK {
  *COD_MOVIMIENTO : NUMBER <<PK>>
  --
  COD_PRODUCTO : NUMBER <<FK>>
  TIPO_MOVIMIENTO : VARCHAR2(20)
  CANTIDAD : NUMBER
  FECHA_MOVIMIENTO : DATE
  MOTIVO : VARCHAR2(100)
}

' Ventas
entity "JRGY_VENTA" as VENTA {
  *COD_VENTA : NUMBER <<PK>>
  --
  COD_USUARIO : NUMBER <<FK>>
  COD_EMPLEADO : NUMBER <<FK>>
  FECHA_VENTA : DATE
}

entity "JRGY_DETALLE_VENTA" as DET_VENTA {
  *COD_VENTA : NUMBER <<PK>><<FK>>
  *COD_PRODUCTO : NUMBER <<PK>><<FK>>
  --
  CANTIDAD : NUMBER
  PRECIO_PRODUCTO : NUMBER
  PRECIO_TOTAL : NUMBER
}

entity "JRGY_PAGO_VENTA" as PAGO_VENTA {
  *COD_PAGO : NUMBER <<PK>>
  --
  COD_VENTA : NUMBER <<FK>>
  COD_MODO_PAGO : NUMBER <<FK>>
  MONTO : NUMBER
  FECHA_PAGO : DATE
}

' Habitaciones, reservas y experiencias
entity "JRGY_HABITACION" as HABITACION {
  *COD_HABITACION : NUMBER <<PK>>
  --
  NRO_HABITACION : NUMBER
  CAPACIDAD : NUMBER
  COD_TIPO_HABITACION : NUMBER <<FK>>
  COD_ESTADO_HABITACION : NUMBER <<FK>>
  PRECIO_BASE : NUMBER
}

entity "JRGY_EXPERIENCIA" as EXPERIENCIA {
  *COD_EXPERIENCIA : NUMBER <<PK>>
  --
  NOMBRE : VARCHAR2(100)
  DESCRIPCION : VARCHAR2(255)
  PRECIO : NUMBER
  TAG : VARCHAR2(50)
  ESTADO : VARCHAR2(20)
}

entity "JRGY_RESERVA" as RESERVA {
  *COD_RESERVA : NUMBER <<PK>>
  --
  COD_USUARIO : NUMBER <<FK>>
  COD_HABITACION : NUMBER <<FK>>
  FECHA_INICIO : DATE
  FECHA_FIN : DATE
  HUESPEDES : NUMBER
  TOTAL_HABITACION : NUMBER
  TOTAL_SERVICIOS : NUMBER
  TOTAL : NUMBER
  COD_ESTADO_RESERVA : NUMBER <<FK>>
  CREATED_AT : DATE
  UPDATED_AT : DATE
}

entity "JRGY_RESERVA_SERVICIO" as RESERVA_SERVICIO {
  *COD_RESERVA_SERVICIO : NUMBER <<PK>>
  --
  COD_RESERVA : NUMBER <<FK>>
  COD_SERVICIO : NUMBER <<FK>>
  FECHA_SERVICIO : DATE
  HORA : NUMBER(2,0)
  CANTIDAD : NUMBER
  PRECIO_UNIT : NUMBER
  TOTAL : NUMBER
  NOTA : VARCHAR2(500)
  ESTADO : VARCHAR2(20)
  CREATED_AT : DATE
  UPDATED_AT : DATE
}

entity "JRGY_EVENTO_RESERVA" as EVENTO_RESERVA {
  *COD_EVENTO_RESERVA : NUMBER <<PK>>
  --
  COD_RESERVA : NUMBER <<FK>>
  TIPO_EVENTO : VARCHAR2(50)
  FECHA_EVENTO : DATE
  NOTAS : VARCHAR2(500)
  CREATED_AT : DATE
  CREATED_BY : NUMBER <<FK>>
}

entity "JRGY_RESERVA_EXP" as RESERVA_EXP {
  *COD_RESERVA_EXP : NUMBER <<PK>>
  --
  COD_RESERVA : NUMBER <<FK>>
  COD_EXPERIENCIA : NUMBER <<FK>>
  CANTIDAD : NUMBER
  PRECIO_UNITARIO : NUMBER
}

entity "JRGY_PAGO_HABITACION" as PAGO_HAB {
  *COD_PAGO_HABITACION : NUMBER <<PK>>
  --
  FECHA_PAGO : DATE
  VALOR_TOTAL_PAGO : NUMBER
  COD_USUARIO : NUMBER <<FK>>
}

entity "JRGY_DETALLE_PAGO_HABITACION" as DET_PAGO_HAB {
  *COD_PAGO_HABITACION : NUMBER <<PK>><<FK>>
  *COD_HABITACION : NUMBER <<PK>><<FK>>
  --
  FECHA_ESTADIA : DATE
  PRECIO_HABITACION : NUMBER
  DIAS : NUMBER
}

entity "JRGY_SOLICITUD_ADMIN" as SOLIC_ADMIN {
  *COD_SOLICITUD : NUMBER <<PK>>
  --
  COD_USUARIO : NUMBER <<FK>>
  ESTADO : VARCHAR2(20)
  MOTIVO : VARCHAR2(255)
  APROBADO_POR : NUMBER <<FK>>
  FECHA_CREACION : DATE
  FECHA_RESOLUCION : DATE
}

' Contacto y soporte
entity "JRGY_CONTACTO" as CONTACTO {
  *COD_CONTACTO : NUMBER <<PK>>
  --
  COD_USUARIO : NUMBER <<FK>>
  NOMBRE : VARCHAR2(120)
  EMAIL : VARCHAR2(150)
  TELEFONO : VARCHAR2(40)
  COD_TIPO : NUMBER <<FK>>
  ASUNTO : VARCHAR2(200)
  MENSAJE : CLOB
  CANAL_RESPUESTA : VARCHAR2(20)
  PRIORIDAD : VARCHAR2(10)
  COD_ESTADO : NUMBER <<FK>>
  COD_EMPLEADO_ASIGNADO : NUMBER <<FK>>
  FECHA_CREACION : DATE
  FECHA_RESPUESTA : DATE
}

entity "JRGY_CONTACTO_RESPUESTA" as CONTACTO_RESP {
  *COD_RESPUESTA : NUMBER <<PK>>
  --
  COD_CONTACTO : NUMBER <<FK>>
  COD_EMPLEADO : NUMBER <<FK>>
  MENSAJE : CLOB
  CANAL_ENVIADO : VARCHAR2(20)
  FECHA_RESPUESTA : DATE
  ES_PUBLICA : CHAR(1)
}

' Relaciones
CAT_EST_USU ||--o{ USUARIO : "COD_ESTADO_USUARIO"
CAT_EST_LAB ||--o{ EMPLEADO : "COD_ESTADO_LABORAL"
CAT_EST_HAB ||--o{ HABITACION : "COD_ESTADO_HABITACION"
CAT_TIPO_HAB ||--o{ HABITACION : "COD_TIPO_HABITACION"
CAT_TIPO_SERV ||--o{ SERVICIO : "COD_TIPO_SERVICIO"
CAT_TIPO_SERV ||--o{ PRODUCTO : "COD_TIPO_SERVICIO"
CAT_MODO_PAGO ||--o{ PAGO_VENTA : "COD_MODO_PAGO"
CAT_EST_RES ||--o{ RESERVA : "COD_ESTADO_RESERVA"
CAT_TIPO_CONTACTO ||--o{ CONTACTO : "COD_TIPO"
CAT_EST_CONTACTO ||--o{ CONTACTO : "COD_ESTADO"

REGION ||--o{ CIUDAD : "COD_REGION"
CIUDAD ||--o{ COMUNA : "COD_CIUDAD"
COMUNA ||--o{ CALLE : "COD_COMUNA"
REGION ||--o{ PROVEEDOR : "COD_REGION"

ROL ||--o{ USUARIO_ROL : "COD_ROL"
USUARIO ||--o{ USUARIO_ROL : "COD_USUARIO"
USUARIO ||--o{ TOKENS : "USER_ID"

DEPTO ||--o{ EMPLEADO : "COD_DEPARTAMENTO"
EMPLEADO ||--|| DEPTO : "JEFE_EMPLEADO_ID"
DEPTO ||--o{ DEPTO_EMP : "COD_DEPARTAMENTO"
EMPLEADO ||--o{ DEPTO_EMP : "COD_EMPLEADO"

USUARIO ||--o{ EMPLEADO : "COD_USUARIO"
USUARIO ||--o{ CLIENTE : "COD_USUARIO"
USUARIO ||--o{ VENTA : "COD_USUARIO"
USUARIO ||--o{ RESERVA : "COD_USUARIO"
USUARIO ||--o{ PAGO_HAB : "COD_USUARIO"
USUARIO ||--o{ SOLIC_ADMIN : "COD_USUARIO"
USUARIO ||--o{ SOLIC_ADMIN : "APROBADO_POR"
USUARIO ||--o{ EVENTO_RESERVA : "CREATED_BY"
USUARIO ||--o{ CONTACTO : "COD_USUARIO"

EMPLEADO ||--o{ PEDIDO : "COD_EMPLEADO"
EMPLEADO ||--o{ VENTA : "COD_EMPLEADO"
EMPLEADO ||--o{ CONTACTO_RESP : "COD_EMPLEADO"
EMPLEADO ||--o{ CONTACTO : "COD_EMPLEADO_ASIGNADO"

PEDIDO ||--o{ DET_PEDIDO : "COD_PEDIDO"
PROVEEDOR ||--o{ DET_PEDIDO : "COD_PROVEEDOR"
PRODUCTO ||--o{ DET_PEDIDO : "COD_PRODUCTO"

PRODUCTO ||--o{ MOV_STOCK : "COD_PRODUCTO"

VENTA ||--o{ DET_VENTA : "COD_VENTA"
PRODUCTO ||--o{ DET_VENTA : "COD_PRODUCTO"
VENTA ||--o{ PAGO_VENTA : "COD_VENTA"

SERVICIO ||--o{ SERVICIO_HORARIO : "COD_SERVICIO"
SERVICIO ||--o{ SERVICIO_PRODUCTO : "COD_SERVICIO"
PRODUCTO ||--o{ SERVICIO_PRODUCTO : "COD_PRODUCTO"

HABITACION ||--o{ DET_PAGO_HAB : "COD_HABITACION"
PAGO_HAB ||--o{ DET_PAGO_HAB : "COD_PAGO_HABITACION"
HABITACION ||--o{ RESERVA : "COD_HABITACION"

SERVICIO ||--o{ RESERVA_SERVICIO : "COD_SERVICIO"
RESERVA ||--o{ RESERVA_SERVICIO : "COD_RESERVA"
RESERVA ||--o{ EVENTO_RESERVA : "COD_RESERVA"
RESERVA ||--o{ RESERVA_EXP : "COD_RESERVA"
EXPERIENCIA ||--o{ RESERVA_EXP : "COD_EXPERIENCIA"

CONTACTO ||--o{ CONTACTO_RESP : "COD_CONTACTO"
@enduml
