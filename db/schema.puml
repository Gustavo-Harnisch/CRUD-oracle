@startuml
!theme plain
left to right direction

' Catálogos y dominios básicos
entity "JRGY_CAT_ESTADO_USUARIO" as CAT_EST_USU {
  *COD_ESTADO_USUARIO : NUMBER <<PK>>
  --
  ESTADO_USUARIO : VARCHAR2(30)
}

entity "JRGY_CAT_ESTADO_LABORAL" as CAT_EST_LAB {
  *COD_ESTADO_LABORAL : NUMBER <<PK>>
  --
  ESTADO_LABORAL : VARCHAR2(30)
}

entity "JRGY_CAT_ESTADO_HABITACION" as CAT_EST_HAB {
  *COD_ESTADO_HABITACION : NUMBER <<PK>>
  --
  ESTADO_HABITACION : VARCHAR2(30)
}

entity "JRGY_CAT_TIPO_HABITACION" as CAT_TIPO_HAB {
  *COD_TIPO_HABITACION : NUMBER <<PK>>
  --
  TIPO_HABITACION : VARCHAR2(50)
}

entity "JRGY_CAT_MODO_PAGO" as CAT_MODO_PAGO {
  *COD_MODO_PAGO : NUMBER <<PK>>
  --
  MODO_PAGO : VARCHAR2(30)
}

entity "JRGY_CAT_ESTADO_RESERVA" as CAT_EST_RES {
  *COD_ESTADO_RESERVA : NUMBER <<PK>>
  --
  ESTADO_RESERVA : VARCHAR2(30)
}

' Geografía
entity "JRGY_REGION" as REGION {
  *COD_REGION : NUMBER <<PK>>
  --
  REGION : VARCHAR2(50)
}

entity "JRGY_CIUDAD" as CIUDAD {
  *COD_CIUDAD : NUMBER <<PK>>
  --
  CIUDAD : VARCHAR2(50)
  COD_REGION : NUMBER <<FK>>
}

entity "JRGY_COMUNA" as COMUNA {
  *COD_COMUNA : NUMBER <<PK>>
  --
  COMUNA : VARCHAR2(50)
  COD_CIUDAD : NUMBER <<FK>>
}

entity "JRGY_CALLE" as CALLE {
  *COD_CALLE : NUMBER <<PK>>
  --
  CALLE : VARCHAR2(50)
  NRO : NUMBER
  COD_COMUNA : NUMBER <<FK>>
}

' Seguridad y roles
entity "JRGY_ROL" as ROL {
  *COD_ROL : NUMBER <<PK>>
  --
  NOMBRE_ROL : VARCHAR2(50)
}

entity "JRGY_USUARIO" as USUARIO {
  *COD_USUARIO : NUMBER <<PK>>
  --
  NOMBRE_USUARIO : VARCHAR2(50)
  APELLIDO1_USUARIO : VARCHAR2(50)
  APELLIDO2_USUARIO : VARCHAR2(50)
  EMAIL_USUARIO : VARCHAR2(100)
  TELEFONO_USUARIO : NUMBER
  CONTRASENA_HASH : VARCHAR2(255)
  COD_ESTADO_USUARIO : NUMBER <<FK>>
}

entity "JRGY_USUARIO_ROL" as USUARIO_ROL {
  *COD_USUARIO : NUMBER <<PK>><<FK>>
  *COD_ROL : NUMBER <<PK>><<FK>>
}

entity "TOKENS" as TOKENS {
  *TOKEN : VARCHAR2(128) <<PK>>
  --
  USER_ID : NUMBER <<FK>>
  EXPIRES_AT : DATE
  CREATED_AT : DATE
}

' Organización y personal
entity "JRGY_DEPARTAMENTO" as DEPTO {
  *COD_DEPARTAMENTO : NUMBER <<PK>>
  --
  NOMBRE_DEPARTAMENTO : VARCHAR2(50)
  JEFE_EMPLEADO_ID : NUMBER <<FK>>
}

entity "JRGY_EMPLEADO" as EMPLEADO {
  *COD_EMPLEADO : NUMBER <<PK>>
  --
  COD_USUARIO : NUMBER <<FK>>
  COD_DEPARTAMENTO : NUMBER <<FK>>
  CARGO : VARCHAR2(50)
  FECHA_CONTRATACION : DATE
  SALARIO : NUMBER
  COMISION : NUMBER
  COD_ESTADO_LABORAL : NUMBER <<FK>>
}

entity "JRGY_CLIENTE" as CLIENTE {
  *COD_CLIENTE : NUMBER <<PK>>
  --
  COD_USUARIO : NUMBER <<FK>>
  FECHA_ALTA : DATE
}

' Operaciones de inventario/compras
entity "JRGY_PROVEEDOR" as PROVEEDOR {
  *COD_PROVEEDOR : NUMBER <<PK>>
  --
  NOMBRE_PROVEEDOR : VARCHAR2(50)
  DIRECCION_PROVEEDOR : VARCHAR2(100)
  TELEFONO_PROVEEDOR : NUMBER
  COD_REGION : NUMBER <<FK>>
}

entity "JRGY_PRODUCTO" as PRODUCTO {
  *COD_PRODUCTO : NUMBER <<PK>>
  --
  NOMBRE_PRODUCTO : VARCHAR2(50)
  TIPO_PRODUCTO : VARCHAR2(20)
  PRECIO_PRODUCTO : NUMBER
  CANTIDAD_PRODUCTO : NUMBER
  STOCK_PRODUCTO : NUMBER
}

entity "JRGY_PEDIDO" as PEDIDO {
  *COD_PEDIDO : NUMBER <<PK>>
  --
  VALOR_TOTAL : NUMBER
  FECHA_PEDIDO : DATE
  COD_EMPLEADO : NUMBER <<FK>>
}

entity "JRGY_DETALLE_PEDIDO" as DET_PEDIDO {
  *COD_PEDIDO : NUMBER <<PK>><<FK>>
  *COD_PROVEEDOR : NUMBER <<PK>><<FK>>
  *COD_PRODUCTO : NUMBER <<PK>><<FK>>
  --
  NOMBRE_PRODUCTO : VARCHAR2(50)
  CANTIDAD_PRODUCTO : NUMBER
  PRECIO_COMPRA : NUMBER
  PRECIO_TOTAL : NUMBER
}

entity "JRGY_MOVIMIENTO_STOCK" as MOV_STOCK {
  *COD_MOVIMIENTO : NUMBER <<PK>>
  --
  COD_PRODUCTO : NUMBER <<FK>>
  TIPO_MOVIMIENTO : VARCHAR2(20)
  CANTIDAD : NUMBER
  FECHA_MOVIMIENTO : DATE
  MOTIVO : VARCHAR2(100)
}

' Ventas
entity "JRGY_VENTA" as VENTA {
  *COD_VENTA : NUMBER <<PK>>
  --
  COD_USUARIO : NUMBER <<FK>>
  COD_EMPLEADO : NUMBER <<FK>>
  FECHA_VENTA : DATE
}

entity "JRGY_DETALLE_VENTA" as DET_VENTA {
  *COD_VENTA : NUMBER <<PK>><<FK>>
  *COD_PRODUCTO : NUMBER <<PK>><<FK>>
  --
  CANTIDAD : NUMBER
  PRECIO_PRODUCTO : NUMBER
  PRECIO_TOTAL : NUMBER
}

entity "JRGY_PAGO_VENTA" as PAGO_VENTA {
  *COD_PAGO : NUMBER <<PK>>
  --
  COD_VENTA : NUMBER <<FK>>
  COD_MODO_PAGO : NUMBER <<FK>>
  MONTO : NUMBER
  FECHA_PAGO : DATE
}

 ' Habitaciones y reservas
entity "JRGY_HABITACION" as HABITACION {
  *COD_HABITACION : NUMBER <<PK>>
  --
  NRO_HABITACION : NUMBER
  CAPACIDAD : NUMBER
  COD_TIPO_HABITACION : NUMBER <<FK>>
  COD_ESTADO_HABITACION : NUMBER <<FK>>
  PRECIO_BASE : NUMBER
}

entity "JRGY_EXPERIENCIA" as EXPERIENCIA {
  *COD_EXPERIENCIA : NUMBER <<PK>>
  --
  NOMBRE : VARCHAR2(100)
  DESCRIPCION : VARCHAR2(255)
  PRECIO : NUMBER
  TAG : VARCHAR2(50)
  ESTADO : VARCHAR2(20)
}

entity "JRGY_RESERVA" as RESERVA {
  *COD_RESERVA : NUMBER <<PK>>
  --
  COD_USUARIO : NUMBER <<FK>>
  COD_HABITACION : NUMBER <<FK>>
  FECHA_INICIO : DATE
  FECHA_FIN : DATE
  HUESPEDES : NUMBER
  TOTAL : NUMBER
  COD_ESTADO_RESERVA : NUMBER <<FK>>
  CREATED_AT : DATE
  UPDATED_AT : DATE
}

entity "JRGY_EVENTO_RESERVA" as EVENTO_RESERVA {
  *COD_EVENTO_RESERVA : NUMBER <<PK>>
  --
  COD_RESERVA : NUMBER <<FK>>
  TIPO_EVENTO : VARCHAR2(50)
  FECHA_EVENTO : DATE
  NOTAS : VARCHAR2(500)
  CREATED_AT : DATE
  CREATED_BY : NUMBER <<FK>>
}

entity "JRGY_RESERVA_EXP" as RESERVA_EXP {
  *COD_RESERVA_EXP : NUMBER <<PK>>
  --
  COD_RESERVA : NUMBER <<FK>>
  COD_EXPERIENCIA : NUMBER <<FK>>
  CANTIDAD : NUMBER
  PRECIO_UNITARIO : NUMBER
}

entity "JRGY_PAGO_HABITACION" as PAGO_HAB {
  *COD_PAGO_HABITACION : NUMBER <<PK>>
  --
  FECHA_PAGO : DATE
  VALOR_TOTAL_PAGO : NUMBER
  COD_USUARIO : NUMBER <<FK>>
}

entity "JRGY_DETALLE_PAGO_HABITACION" as DET_PAGO_HAB {
  *COD_PAGO_HABITACION : NUMBER <<PK>><<FK>>
  *COD_HABITACION : NUMBER <<PK>><<FK>>
  --
  FECHA_ESTADIA : DATE
  PRECIO_HABITACION : NUMBER
  DIAS : NUMBER
}

entity "JRGY_SOLICITUD_ADMIN" as SOLIC_ADMIN {
  *COD_SOLICITUD : NUMBER <<PK>>
  --
  COD_USUARIO : NUMBER <<FK>>
  ESTADO : VARCHAR2(20)
  MOTIVO : VARCHAR2(255)
  APROBADO_POR : NUMBER <<FK>>
  FECHA_CREACION : DATE
  FECHA_RESOLUCION : DATE
}

' Relaciones
USUARIO ||--o{ EMPLEADO : "COD_USUARIO"
USUARIO ||--o{ CLIENTE : "COD_USUARIO"
USUARIO ||--o{ VENTA : "COD_USUARIO"
USUARIO ||--o{ USUARIO_ROL : "COD_USUARIO"
USUARIO ||--o{ PAGO_HAB : "COD_USUARIO"
USUARIO ||--o{ SOLIC_ADMIN : "COD_USUARIO"
USUARIO ||--o{ SOLIC_ADMIN : "APROBADO_POR"
USUARIO ||--o{ EVENTO_RESERVA : "CREATED_BY"
TOKENS ||--|| USUARIO : "USER_ID"

DEPTO ||--o{ EMPLEADO : "COD_DEPARTAMENTO"
DEPTO ||--|| EMPLEADO : "JEFE_EMPLEADO_ID"

ROL ||--o{ USUARIO_ROL : "COD_ROL"

REGION ||--o{ CIUDAD : "COD_REGION"
CIUDAD ||--o{ COMUNA : "COD_CIUDAD"
COMUNA ||--o{ CALLE : "COD_COMUNA"
REGION ||--o{ PROVEEDOR : "COD_REGION"

HABITACION ||--o{ DET_PAGO_HAB : "COD_HABITACION"
PAGO_HAB ||--o{ DET_PAGO_HAB : "COD_PAGO_HABITACION"
HABITACION ||--o{ RESERVA : "COD_HABITACION"

EMPLEADO ||--o{ PEDIDO : "COD_EMPLEADO"
EMPLEADO ||--o{ VENTA : "COD_EMPLEADO"
PEDIDO ||--o{ DET_PEDIDO : "COD_PEDIDO"
PROVEEDOR ||--o{ DET_PEDIDO : "COD_PROVEEDOR"
PRODUCTO ||--o{ DET_PEDIDO : "COD_PRODUCTO"

PRODUCTO ||--o{ MOV_STOCK : "COD_PRODUCTO"

VENTA ||--o{ DET_VENTA : "COD_VENTA"
PRODUCTO ||--o{ DET_VENTA : "COD_PRODUCTO"
VENTA ||--o{ PAGO_VENTA : "COD_VENTA"
CAT_MODO_PAGO ||--o{ PAGO_VENTA : "COD_MODO_PAGO"

RESERVA ||--o{ EVENTO_RESERVA : "COD_RESERVA"
RESERVA ||--o{ RESERVA_EXP : "COD_RESERVA"
EXPERIENCIA ||--o{ RESERVA_EXP : "COD_EXPERIENCIA"
CAT_EST_RES ||--o{ RESERVA : "COD_ESTADO_RESERVA"

CAT_TIPO_HAB ||--o{ HABITACION : "COD_TIPO_HABITACION"
CAT_EST_HAB ||--o{ HABITACION : "COD_ESTADO_HABITACION"

CAT_EST_USU ||--o{ USUARIO : "COD_ESTADO_USUARIO"
CAT_EST_LAB ||--o{ EMPLEADO : "COD_ESTADO_LABORAL"

@enduml
